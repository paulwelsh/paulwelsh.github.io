<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:lastBlockDepth="2" MadCap:lastHeight="756" MadCap:lastWidth="1290" MadCap:tocPath="eSellerate Affiliates|Creating eST Downloads" MadCap:medium="print" MadCap:InPreviewMode="false" MadCap:PreloadImages="false" MadCap:RuntimeFileType="Topic" MadCap:TargetType="PDF">
    <head><title>Retrieving Affiliate Information: Visual Basic Code Example</title>
        <link href="file:///H:/Win/_eSellerate Docs Flare/Output/pwelsh/Temporary/PDF/PDF_1ABAD487/Resources/Stylesheets/Styles.css" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <h3 MadCap:xrefTargetName="Retrieving Affiliate Information: Visual Basic Code Example" MadCap:sourceTitle="Retrieving Affiliate Information: Visual Basic Code Example"><a MadCap:generatedBookmark="TOC" name="Retrieving Affiliate Information: Visual Basic Code Example"></a>Retrieving Affiliate Information: Visual Basic Code Example</h3>
        <p>The following sample Visual Basic code demonstrates how to retrieve the affiliate-specific URL placed in the Windows registry by an eST download. This manual approach to getting the URL is not required when using Integrated or Embedded Web Store eSellers. Please see     <![CDATA[ ]]><MadCap:xref href="file:///H:/Win/_eSellerate Docs Flare/Content/eSellerate_Affiliates/Affiliates_InAppBuy.htm" target="" title="" alt="" MadCap:xrefTarget="In-App Buy URL"><span style="color: Blue;" class="mcFormatColor"><u>"In-App Buy URL" on page 1</u></span></MadCap:xref> for details.   </p>
        <p class="pwCode">Const HKEY_CURRENT_USER = &amp;H80000001<br />Const KEY_QUERY_VALUE = &amp;H1<br />Const ERROR_NONE = 0<br /><br />Private Declare Function RegOpenKeyEx _<br />&#160;&#160;&#160;Lib "advapi32.dll" Alias "RegOpenKeyExA" _<br />&#160;&#160;&#160;(ByVal hKey As Long, ByVal sSubKey As String, _<br />&#160;&#160;&#160;ByVal lZero As Long, ByVal lAccess As Long, _<br />&#160;&#160;&#160;lResult As Long) As Long<br /><br />Private Declare Function RegQueryValueExString _<br />&#160;&#160;&#160;Lib "advapi32.dll" Alias "RegQueryValueExA" _<br />&#160;&#160;&#160;(ByVal hKey As Long, ByVal sName As String, _<br />&#160;&#160;&#160;ByVal lZero As Long, lType As Long, _<br />&#160;&#160;&#160;ByVal sValue As String, lSize As Long) As Long<br /><br />Private Declare Function RegCloseKey _<br />&#160;&#160;&#160;Lib "advapi32.dll" _<br />&#160;&#160;(ByVal hKey As Long) As Long<br /><br />Private Function GetWebStoreURL(publisherID As String, skuRefNum As String) As String<br />&#160;&#160;&#160;Dim key As Long<br />&#160;&#160;&#160;Dim size As Long<br />&#160;&#160;&#160;Dim result As Long<br />&#160;&#160;&#160;Dim value As String<br /><br />&#160;&#160;&#160;'Locate the pertinent key.<br />&#160;&#160;&#160;value = "Software\eSellerate\Affiliates\" &amp; publisherID &amp; "\" &amp; skuRefNum<br />&#160;&#160;&#160;result = RegOpenKeyEx(HKEY_CURRENT_USER, value, 0, KEY_QUERY_VALUE, key)<br />&#160;&#160;&#160;If result = ERROR_NONE Then<br />&#160;&#160;&#160;&#160;&#160;&#160;size = 256<br />&#160;&#160;&#160;&#160;&#160;&#160;value = String(size, 0)<br />&#160;&#160;&#160;&#160;&#160;&#160;'Retrieve the pertinent value.<br />&#160;&#160;&#160;&#160;&#160;&#160;result = RegQueryValueExString(key, "URL", 0, 0, value, size)<br />&#160;&#160;&#160;&#160;&#160;&#160;If result = ERROR_NONE Then<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;'Return the value.<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GetWebStoreURL = Left$(value, size - 1)<br />&#160;&#160;&#160;&#160;&#160;&#160;Else<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GetWebStoreURL = ""<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;End If<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;RegCloseKey(key)<br />&#160;&#160;&#160;&#160;&#160;&#160;Else<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GetWebStoreURL = ""<br />&#160;&#160;&#160;&#160;&#160;&#160;End If<br /><br />        End Function</p>
    </body>
</html>